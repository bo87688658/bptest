<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>BP Offline / Online</title>
<link rel="icon" type="image/x-icon" href="icon.png">

<!-- PeerJS -->
<script src="https://cdn.jsdelivr.net/npm/peerjs@1.4.7/dist/peerjs.min.js"></script>

<style>
@font-face {
    font-family: 'cpBurbankSmall';
    src: url('assets/cpBurbankSmall.ttf') format('truetype');
}

body {
    margin:0;
    font-family:'cpBurbankSmall',Arial,sans-serif;
    overflow:hidden;
    background: radial-gradient(circle, rgba(46,71,170,1) 0%, rgba(23,35,85,1) 100%);
    color:white;
}

canvas {
    display:block;
    background:#1e90ff;
}

/* Telas */
.tela {
    position:absolute;
    top:0;left:0;
    width:100%;height:100%;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    background: radial-gradient(circle, rgba(46,71,170,1) 0%, rgba(23,35,85,1) 100%);
    z-index:20;
}

.tela input, .tela button {
    margin:8px;
    padding:10px;
    font-size:18px;
    border-radius:6px;
    border:none;
    font-family:'cpBurbankSmall',Arial,sans-serif;
}

.tela button {
    cursor:pointer;
    background:#1e90ff;
    color:white;
    font-weight:bold;
}

.loader {
    width:100px;
    height:100px;
    background: url('assets/load.png') no-repeat center center;
    background-size:contain;
    filter: brightness(0) invert(1);
    animation: rotate 2s ease-in-out infinite;
}

@keyframes rotate {
    0%{transform:rotate(0deg);}
    50%{transform:rotate(180deg);}
    100%{transform:rotate(360deg);}
}

.loading-text {
    margin-top:25px;
    font-size:26px;
    letter-spacing:1px;
}

.dots::after {
    content:'.';
    animation:dots 1.5s infinite;
}

@keyframes dots {
    0%{content:'.';}
    33%{content:'..';}
    66%{content:'...';}
    100%{content:'.';}
}
</style>
</head>
<body>

<!-- 1️⃣ Tela Username + Cor -->
<div id="usernameScreen" class="tela">
    <h2>Escolha seu username e cor</h2>
    <input type="text" id="usernameInput" placeholder="Digite seu username">
    <input type="color" id="colorPicker" value="#ff0000">
    <button id="nextButton">Próximo</button>
</div>

<!-- 2️⃣ Tela Modo -->
<div id="modeScreen" class="tela" style="display:none;">
    <h2>Escolha o modo</h2>
    <button id="offlineBtn">Offline</button>
    <button id="onlineBtn">Online</button>
</div>

<!-- 3️⃣ Tela Online -->
<div id="onlineScreen" class="tela" style="display:none;">
    <input type="text" id="peerIdInput" placeholder="Digite um ID ou deixe em branco para gerar">
    <button id="createServerBtn">Criar Servidor</button>
    <button id="joinServerBtn">Entrar em Servidor</button>
</div>

<!-- Loader -->
<div id="loaderScreen" class="tela" style="display:none;">
    <div class="loader"></div>
    <div class="loading-text">Loading<span class="dots"></span></div>
</div>

<!-- Canvas do jogo -->
<canvas id="game" width="1000" height="632"></canvas>

<!-- Música -->
<audio id="bgMusic" src="assets/town.mp3" loop></audio>

<!-- Scripts do jogo -->
<script src="peer.js"></script> <!-- PeerJS separado -->
<script src="assets/penguin.js"></script>
<script src="assets/towncollision.js"></script>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const bgMusic = document.getElementById("bgMusic");

// Sprites
const imgBase = new Image();
imgBase.src = "assets/penguin_base.png";
const imgColor = new Image();
imgColor.src = "assets/penguin_color.png";
const mapImg = new Image();
mapImg.src = "assets/towntest.png";

// Outras variáveis do jogo
let username = "";
let usernameColor = "#ff0000";
let state="idle", frameIndex=0, frameTimer=0;

// Pinguim
const penguin={x:400,y:250,targetX:400,targetY:250,speed:2.5,suffix:270,flip:false};
let mouseX=400, mouseY=250;

// Telas
const usernameScreen = document.getElementById("usernameScreen");
const modeScreen = document.getElementById("modeScreen");
const onlineScreen = document.getElementById("onlineScreen");
const loaderScreen = document.getElementById("loaderScreen");

// Username + cor
document.getElementById("nextButton").onclick = ()=>{
    username = document.getElementById("usernameInput").value || "Player";
    usernameColor = document.getElementById("colorPicker").value;
    usernameScreen.style.display="none";
    modeScreen.style.display="flex";
};

// Mouse
canvas.addEventListener("mousemove", e=>{
    const rect = canvas.getBoundingClientRect();
    mouseX = e.clientX - rect.left;
    mouseY = e.clientY - rect.top;
});
canvas.addEventListener("click", e=>{
    const rect = canvas.getBoundingClientRect();
    penguin.targetX = e.clientX - rect.left;
    penguin.targetY = e.clientY - rect.top;
    state="walk";
});

// Aqui continua todo o seu código de renderização, chat e game loop...
</script>
</body>
</html>
